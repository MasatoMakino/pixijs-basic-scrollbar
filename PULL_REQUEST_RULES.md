# Pull Request Rules (Draft)

## Pull Requestの目的

Pull Requestはコミュニティとのコミュニケーションツールであり、以下の2つの主要な目的があります：

1. レビュアーの理解促進

   - 変更の影響範囲を明確に把握できるようにする
   - レビュー時の判断材料を適切に提供する

2. 変更履歴の追跡可能性
   - 後から変更内容とその理由を理解できるようにする
   - システムの進化の過程を記録する
   - エージェントによる自動解析を可能にする
     - 変更パターンの分析
     - コード品質の追跡
     - 依存関係の管理
   - CIシステムによる自動検証を効率化する
     - テスト実行の適正化
     - ビルドプロセスの最適化
     - デプロイ判断の自動化

## 基本原則

上記の目的を達成するため、以下の原則に従います：

1. コミュニティガイドラインが存在する場合は、それを優先します

   - PR作成前にREADMEを読み、コミュニティガイドラインの有無を確認する
   - コミュニティガイドラインが存在する場合は、それに従う
   - このドキュメントのルールは、コミュニティガイドラインを補完するものとして扱う

2. 1つのPRは1つのIssueを解決することを目的とする

   - 各PRは明確に定義された1つの課題に対応する
   - PRの目的（解決する課題）を最初に明示する
   - 複数のIssueが含まれる場合は、その理由を明確に説明する

3. 変更の種類と影響度を明示する

   ### 変更の種類

   - 機能追加（Feature）
   - バグ修正（Bug Fix）
   - テスト拡充（Test）
   - モジュールメンテナンス（Maintenance）
   - パフォーマンス改善（Performance）
   - ドキュメント更新（Documentation）

   ### 影響度

   - Breaking Change：互換性が損なわれる変更

     - 例：既存APIの削除・仕様変更
     - 例：依存関係の互換性を破る更新

   - Minor Change：互換性が維持される機能の変更・拡充

     - 例：新機能の追加
     - 例：既存機能の拡張

   - Patch：機能と互換性が維持される変更
     - 例：バグ修正
     - 例：ドキュメント更新
     - 例：テストの追加

## PR作成時のルール

### 1. Git情報の取得と分析

PRの作成を開始する前に、以下のGitコマンドを使用して変更情報を正確に把握します：

```bash
# 現在のブランチ名を確認
git branch --show-current

# mainブランチとの差分を確認（コミット一覧）
git log main...HEAD --pretty=format:"Commit: %H%nSubject: %s%nBody: %b" --name-status

# 詳細な差分を確認
git diff main...HEAD
```

これらの情報を使用して：

1. 変更されたファイルの一覧を作成
2. 各ファイルの変更内容を分析
3. コミットメッセージから変更の意図を抽出
4. ブランチ名から作業の目的を推測
5. 変更の種類と影響度を判断

### 2. PRタイトルの決定

取得したGit情報から以下の形式でPRタイトルを作成します：

形式：`[種類/影響度] [#Issue番号] 目的`

目的の決定方法：

1. Issue番号が明確な場合、Issueのタイトルを基に目的を特定
2. ブランチ名が命名規則にしたがっている場合（例：`feature/add-smooth-scroll`）、その情報を活用
3. コミットメッセージから主要な目的を抽出

例：

- 悪い例：
  - `[Feature/Breaking] [#123] スクロールバーのコードを変更`
    → 変更内容の説明になっており、目的が不明確
- 良い例：
  - `[Feature/Breaking] [#123] スクロール操作のアクセシビリティを改善`
    → 目的（アクセシビリティ改善）が明確
  - `[Feature/Minor] [#124] スムーズスクロールでUXを向上`
    → 目的（UX向上）が明確
  - `[Bug Fix/Patch] [#125] スクロール位置の計算バグを修正`
    → 目的（バグ修正）が明確

推測したタイトルをレビューし、必要に応じて調整します。とくに：

- 目的が明確に伝わっているか
- 変更の種類と影響度が適切か
- Issue番号が正しく紐付けられているか

### 3. PR説明文の作成

必須項目：

- 解決する課題の説明

  - バグ修正の場合：

    - 現状の挙動
    - 期待される挙動
    - 問題が発生する条件
    - 影響を受けるユースケース
    - 影響を受けるバージョン範囲
      - 最初に確認されたバージョン
      - 影響が及ぶ最新のバージョン
    - 回避策（任意）
      - 一時的な対処方法
      - 対処方法の制限事項
    - 関連する可能性のある他のバグ（任意）
      - 類似の症状を持つバグ
      - 同じ原因から派生する可能性のある問題

  - 機能追加の場合：

    - 追加する機能の概要
    - 想定されるユースケース
    - 技術的な考慮事項（任意）
      - 実装上の制約や要件
      - パフォーマンスへの影響
      - セキュリティへの影響
      - 将来的な拡張可能性

  - 性能改善の場合：
    - 改善前の性能指標
    - 改善後の性能指標
    - 測定環境と条件

- 実装方法の概要
- 関連するIssueへのリンク
- Breaking Changeの場合、移行手順の説明

- テストの変更内容（変更がある場合）

  - 追加されたテスト
    - テストの目的と検証内容
    - 新しいテストケースのリスト
    - テストファイルの変更点（git diffから抽出）
    - テストの追加理由
    - テストが検証する具体的な動作や状態
  - 修正されたテスト
    - 修正の理由
    - 変更前後の動作の違い
    - テストファイルの具体的な変更内容（git diffから抽出）
  - 削除されたテスト
    - 削除の理由
    - 代替となるテストの有無
    - 削除による影響の評価

- 依存モジュールの状態（必須）

  以下の情報はpackage.jsonとpackage-lock.jsonの差分から自動的に抽出します：

  - 変更がない場合：
    - git diffで確認の上「依存モジュールの変更なし」と明記
  - 変更がある場合は以下を記載：
    - 更新されたモジュール
      - バージョン変更の詳細（必須）
        - 更新前後のバージョン（git diffから自動抽出）
        - メジャーバージョン変更がある場合はその影響
      - 影響範囲の評価（必須）
        - モジュールの外部露出の有無
        - プロジェクトの互換性への影響
      - 補足情報（状況に応じて記載）
        - 非推奨化や将来的な変更予定
        - 公開APIへの具体的な影響
        - 既存機能への具体的な影響
        - 型定義への影響
      - 更新の目的（必須）
        - 機能追加の場合：
          - 追加される機能の概要
          - 既存機能との関連性
        - バグ修正の場合：
          - 修正される問題の概要
          - 影響を受ける機能
        - 互換性維持の場合：
          - 更新が必要な理由
          - 既存機能への影響
        - その他の場合：
          - 更新の具体的な理由
    - 新規追加されたモジュール
      - 追加の理由
      - 影響を受ける機能
      - 選定理由と検討した代替案
    - 削除されたモジュール
      - 削除の理由
      - 代替手段の説明
      - 削除による影響範囲

任意項目（状況に応じて）：

- 複数のIssueを含む場合、その理由と関連性
- 特別な注意が必要な実装箇所
- レビュー時の確認ポイント
- 上記の必須項目では説明しきれない補足情報がある場合は、ここに記載する
