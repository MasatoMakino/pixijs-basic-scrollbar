"use strict";(self.webpackChunk_masatomakino_pixijs_basic_scrollbar=self.webpackChunk_masatomakino_pixijs_basic_scrollbar||[]).push([[851],{6851(e,t,n){n.d(t,{CanvasRenderer:()=>se});var a=n(8507),r=n(594),o=n(1160),i=n(2079),s=n(9313),c=n(2577),l=n(1761);let h;function d(e){const t=l.e.get().createCanvas(6,1),n=t.getContext("2d");return n.fillStyle=e,n.fillRect(0,0,6,1),t}function u(){if(void 0!==h)return h;try{const e=d("#ff00ff"),t=d("#ffff00"),n=l.e.get().createCanvas(6,1).getContext("2d");n.globalCompositeOperation="multiply",n.drawImage(e,0,0),n.drawImage(t,2,0);const a=n.getImageData(2,0,1,1);if(a){const e=a.data;h=255===e[0]&&0===e[1]&&0===e[2]}else h=!1}catch(e){h=!1}return h}const p={canvas:null,convertTintToImage:!1,cacheStepsPerColorChannel:8,canUseMultiply:u(),tintMethod:null,_canvasSourceCache:new WeakMap,_unpremultipliedCache:new WeakMap,getCanvasSource:e=>{const t=e.source,n=t?.resource;if(!n)return null;const a="premultiplied-alpha"===t.alphaMode,r=t.resourceWidth??t.pixelWidth,o=t.resourceHeight??t.pixelHeight,i=r!==t.pixelWidth||o!==t.pixelHeight;if(a){if((n instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&n instanceof OffscreenCanvas)&&!i)return n;const e=p._unpremultipliedCache.get(t);if(e?.resourceId===t._resourceId)return e.canvas}if(n instanceof Uint8Array||n instanceof Uint8ClampedArray||n instanceof Int8Array||n instanceof Uint16Array||n instanceof Int16Array||n instanceof Uint32Array||n instanceof Int32Array||n instanceof Float32Array||n instanceof ArrayBuffer){const e=p._canvasSourceCache.get(t);if(e?.resourceId===t._resourceId)return e.canvas;const a=l.e.get().createCanvas(t.pixelWidth,t.pixelHeight),r=a.getContext("2d"),o=r.createImageData(t.pixelWidth,t.pixelHeight),i=o.data,s=n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength);if("bgra8unorm"===t.format)for(let e=0;e<i.length&&e+3<s.length;e+=4)i[e]=s[e+2],i[e+1]=s[e+1],i[e+2]=s[e],i[e+3]=s[e+3];else i.set(s.subarray(0,i.length));return r.putImageData(o,0,0),p._canvasSourceCache.set(t,{canvas:a,resourceId:t._resourceId}),a}if(a){const e=l.e.get().createCanvas(t.pixelWidth,t.pixelHeight),a=e.getContext("2d",{willReadFrequently:!0});e.width=t.pixelWidth,e.height=t.pixelHeight,a.drawImage(n,0,0);const r=a.getImageData(0,0,e.width,e.height),o=r.data;for(let e=0;e<o.length;e+=4){const t=o[e+3];if(t>0){const n=255/t;o[e]=Math.min(255,o[e]*n+.5),o[e+1]=Math.min(255,o[e+1]*n+.5),o[e+2]=Math.min(255,o[e+2]*n+.5)}}return a.putImageData(r,0,0),p._unpremultipliedCache.set(t,{canvas:e,resourceId:t._resourceId}),e}if(i){const e=p._canvasSourceCache.get(t);if(e?.resourceId===t._resourceId)return e.canvas;const a=l.e.get().createCanvas(t.pixelWidth,t.pixelHeight),r=a.getContext("2d");return a.width=t.pixelWidth,a.height=t.pixelHeight,r.drawImage(n,0,0),p._canvasSourceCache.set(t,{canvas:a,resourceId:t._resourceId}),a}return n},getTintedCanvas:(e,t)=>{const n=e.texture,a=c.Q.shared.setValue(t).toHex(),r=n.tintCache||(n.tintCache={}),o=r[a],i=n.source._resourceId;if(o?.tintId===i)return o;const s=o&&"getContext"in o?o:l.e.get().createCanvas();if(p.tintMethod(n,t,s),s.tintId=i,p.convertTintToImage&&void 0!==s.toDataURL){const e=l.e.get().createImage();e.src=s.toDataURL(),e.tintId=i,r[a]=e}else r[a]=s;return r[a]},getTintedPattern:(e,t)=>{const n=c.Q.shared.setValue(t).toHex(),a=e.patternCache||(e.patternCache={}),r=e.source._resourceId;let o=a[n];return o?.tintId===r||(p.canvas||(p.canvas=l.e.get().createCanvas()),p.tintMethod(e,t,p.canvas),o=p.canvas.getContext("2d").createPattern(p.canvas,"repeat"),o.tintId=r,a[n]=o),o},applyPatternTransform:(e,t,n=!0)=>{if(!t)return;const a=e;if(!a.setTransform)return;const r=globalThis.DOMMatrix;if(!r)return;const o=new r([t.a,t.b,t.c,t.d,t.tx,t.ty]);a.setTransform(n?o.inverse():o)},tintWithMultiply:(e,t,n)=>{const a=n.getContext("2d"),r=e.frame.clone(),o=e.source._resolution??e.source.resolution??1,s=e.rotate;r.x*=o,r.y*=o,r.width*=o,r.height*=o;const l=i.E.isVertical(s),h=l?r.height:r.width,d=l?r.width:r.height;n.width=Math.ceil(h),n.height=Math.ceil(d),a.save(),a.fillStyle=c.Q.shared.setValue(t).toHex(),a.fillRect(0,0,h,d),a.globalCompositeOperation="multiply";const u=p.getCanvasSource(e);u?(s&&p._applyInverseRotation(a,s,r.width,r.height),a.drawImage(u,r.x,r.y,r.width,r.height,0,0,r.width,r.height),a.globalCompositeOperation="destination-atop",a.drawImage(u,r.x,r.y,r.width,r.height,0,0,r.width,r.height),a.restore()):a.restore()},tintWithOverlay:(e,t,n)=>{const a=n.getContext("2d"),r=e.frame.clone(),o=e.source._resolution??e.source.resolution??1,s=e.rotate;r.x*=o,r.y*=o,r.width*=o,r.height*=o;const l=i.E.isVertical(s),h=l?r.height:r.width,d=l?r.width:r.height;n.width=Math.ceil(h),n.height=Math.ceil(d),a.save(),a.globalCompositeOperation="copy",a.fillStyle=c.Q.shared.setValue(t).toHex(),a.fillRect(0,0,h,d),a.globalCompositeOperation="destination-atop";const u=p.getCanvasSource(e);u?(s&&p._applyInverseRotation(a,s,r.width,r.height),a.drawImage(u,r.x,r.y,r.width,r.height,0,0,r.width,r.height),a.restore()):a.restore()},tintWithPerPixel:(e,t,n)=>{const a=n.getContext("2d"),r=e.frame.clone(),o=e.source._resolution??e.source.resolution??1,s=e.rotate;r.x*=o,r.y*=o,r.width*=o,r.height*=o;const c=i.E.isVertical(s),l=c?r.height:r.width,h=c?r.width:r.height;n.width=Math.ceil(l),n.height=Math.ceil(h),a.save(),a.globalCompositeOperation="copy";const d=p.getCanvasSource(e);if(!d)return void a.restore();s&&p._applyInverseRotation(a,s,r.width,r.height),a.drawImage(d,r.x,r.y,r.width,r.height,0,0,r.width,r.height),a.restore();const u=t>>16&255,g=t>>8&255,m=255&t,x=a.getImageData(0,0,l,h),f=x.data;for(let e=0;e<f.length;e+=4)f[e]=f[e]*u/255,f[e+1]=f[e+1]*g/255,f[e+2]=f[e+2]*m/255;a.putImageData(x,0,0)},_applyInverseRotation:(e,t,n,a)=>{const r=i.E.inv(t),o=i.E.uX(r),s=i.E.uY(r),c=i.E.vX(r),l=i.E.vY(r),h=-Math.min(0,o*n,c*a,o*n+c*a),d=-Math.min(0,s*n,l*a,s*n+l*a);e.transform(o,s,c,l,h,d)}};p.tintMethod=p.canUseMultiply?p.tintWithMultiply:p.tintWithPerPixel;var g=n(5589),m=n(198),x=n(4676),f=n(115),v=n(7276),y=n(2806),C=n(2801),_=n(2413);const w=new s.u,T=new s.u,b=new s.u,k=new s.u;function M(e,t,n){e.beginPath();for(let a=0;a<n.length;a+=3){const r=2*n[a],o=2*n[a+1],i=2*n[a+2];e.moveTo(t[r],t[r+1]),e.lineTo(t[o],t[o+1]),e.lineTo(t[i],t[i+1]),e.closePath()}e.fill()}function I(e,t){switch(t.type){case"rectangle":{const n=t;e.rect(n.x,n.y,n.width,n.height);break}case"roundedRectangle":{const n=t;!function(e,t,n,a,r,o){o=Math.max(0,Math.min(o,Math.min(a,r)/2)),e.moveTo(t+o,n),e.lineTo(t+a-o,n),e.quadraticCurveTo(t+a,n,t+a,n+o),e.lineTo(t+a,n+r-o),e.quadraticCurveTo(t+a,n+r,t+a-o,n+r),e.lineTo(t+o,n+r),e.quadraticCurveTo(t,n+r,t,n+r-o),e.lineTo(t,n+o),e.quadraticCurveTo(t,n,t+o,n)}(e,n.x,n.y,n.width,n.height,n.radius);break}case"circle":{const n=t;e.arc(n.x,n.y,n.radius,0,2*Math.PI);break}case"ellipse":{const n=t;e.ellipse?e.ellipse(n.x,n.y,n.halfWidth,n.halfHeight,0,0,2*Math.PI):(e.save(),e.translate(n.x,n.y),e.scale(n.halfWidth,n.halfHeight),e.arc(0,0,1,0,2*Math.PI),e.restore());break}case"triangle":{const n=t;e.moveTo(n.x,n.y),e.lineTo(n.x2,n.y2),e.lineTo(n.x3,n.y3),e.closePath();break}default:{const n=t,a=n.points;if(!a?.length)break;e.moveTo(a[0],a[1]);for(let t=2;t<a.length;t+=2)e.lineTo(a[t],a[t+1]);n.closePath&&e.closePath();break}}}function P(e,t){if(!t?.length)return!1;for(let n=0;n<t.length;n++){const a=t[n];if(!a?.shape)continue;const r=a.transform,o=r&&!r.isIdentity();o&&(e.save(),e.transform(r.a,r.b,r.c,r.d,r.tx,r.ty)),I(e,a.shape),o&&e.restore()}return!0}function S(e,t,n,a){const r=e.fill;if(r instanceof v._){r.buildGradient();const o=r.texture;if(o){const i=p.getTintedPattern(o,t),s=n?k.copyFrom(n).scale(o.source.pixelWidth,o.source.pixelHeight):k.copyFrom(r.transform);return a&&!e.textureSpace&&s.append(a),p.applyPatternTransform(i,s),i}}if(r instanceof y.m){const e=p.getTintedPattern(r.texture,t);return p.applyPatternTransform(e,r.transform),e}const o=e.texture;if(o&&o!==g.g.WHITE){if(!o.source.resource)return"#808080";const a=p.getTintedPattern(o,t),r=n?k.copyFrom(n).scale(o.source.pixelWidth,o.source.pixelHeight):e.matrix;return p.applyPatternTransform(a,r),a}return`#${(16777215&t).toString(16).padStart(6,"0")}`}class A{constructor(){this.shader=null}contextChange(e){}execute(e,t){const n=e.renderer,a=n.canvasContext,r=a.activeContext,o=t.groupTransform,s=n.globalUniforms.globalUniformData?.worldColor??4294967295,c=t.groupColorAlpha,l=(s>>>24&255)/255*((c>>>24&255)/255)*(n.filter?.alphaMultiplier??1);if(l<=0)return;const h=16777215&s,d=16777215&c,u=(0,m.D)((0,x.u)(d,h)),v=n._roundPixels|t._roundPixels;r.save(),a.setContextTransform(o,1===v),a.setBlendMode(t.groupBlendMode);const y=t.context.instructions;for(let e=0;e<y.length;e++){const t=y[e];if("texture"===t.action){const e=t.data,n=e.image,s=n?p.getCanvasSource(n):null;if(!s)continue;const c=e.alpha*l;if(c<=0)continue;const h=(0,x.u)(e.style,u);r.globalAlpha=c;let d=s;16777215!==h&&(d=p.getTintedCanvas({texture:n},h));const g=n.frame,m=n.source._resolution??n.source.resolution??1;let f=g.x*m,y=g.y*m;const C=g.width*m,_=g.height*m;d!==s&&(f=0,y=0);const T=e.transform,b=T&&!T.isIdentity(),k=n.rotate;b||k?(w.copyFrom(o),b&&w.append(T),k&&i.E.matrixAppendRotationInv(w,k,e.dx,e.dy,e.dw,e.dh),a.setContextTransform(w,1===v)):a.setContextTransform(o,1===v),r.drawImage(d,f,y,d===s?C:d.width,d===s?_:d.height,k?0:e.dx,k?0:e.dy,e.dw,e.dh),(b||k)&&a.setContextTransform(o,1===v);continue}const n=t.data,s=n?.path?.shapePath;if(!s?.shapePrimitives?.length)continue;const c=n.style,h=(0,x.u)(c.color,u),d=c.alpha*l;if(d<=0)continue;const m="stroke"===t.action;if(r.globalAlpha=d,m){const e=c;r.lineWidth=e.width,r.lineCap=e.cap,r.lineJoin=e.join,r.miterLimit=e.miterLimit}const k=s.shapePrimitives;!m&&n.hole?.shapePath?.shapePrimitives?.length&&(k[k.length-1].holes=n.hole.shapePath.shapePrimitives);for(let e=0;e<k.length;e++){const t=k[e];if(!t?.shape)continue;const n=t.transform,a=n&&!n.isIdentity(),i=c.texture&&c.texture!==g.g.WHITE,s="global"===c.textureSpace?n:null,l=S(c,h,i?(0,_.Y)(T,c,t.shape,s):null,a?b.copyFrom(o).append(n):o);if(a&&(r.save(),r.transform(n.a,n.b,n.c,n.d,n.tx,n.ty)),m){const e=c;if(.5===e.alignment||e.pixelLine)r.strokeStyle=l,r.beginPath(),I(r,t.shape),r.stroke();else{const n=[],a=[],o=[],i=C.y[t.shape.type];if(i?.build(t.shape,n)){const i=t.shape.closePath??!0;(0,f.h)(n,e,!1,i,a,o),r.fillStyle=l,M(r,a,o)}else r.strokeStyle=l,r.beginPath(),I(r,t.shape),r.stroke()}}else r.fillStyle=l,r.beginPath(),I(r,t.shape),P(r,t.holes)?r.fill("evenodd"):r.fill();a&&r.restore()}}r.restore()}destroy(){this.shader=null}}A.extension={type:[a.Ag.CanvasPipesAdaptor],name:"graphics"};var R=n(3136);const W=class e{static _getPatternRepeat(e,t){const n=e&&"clamp-to-edge"!==e,a=t&&"clamp-to-edge"!==t;return n&&a?"repeat":n?"repeat-x":a?"repeat-y":"no-repeat"}start(e,t,n){}execute(t,n){const a=n.elements;if(!a||!a.length)return;const r=t.renderer,o=r.canvasContext,s=o.activeContext;for(let t=0;t<a.length;t++){const c=a[t];if(!c.packAsQuad)continue;const l=c,h=l.texture,d=h?p.getCanvasSource(h):null;if(!d)continue;const u=h.source.style,g=o.smoothProperty,f="nearest"!==u.scaleMode;s[g]!==f&&(s[g]=f),o.setBlendMode(n.blendMode);const v=r.globalUniforms.globalUniformData?.worldColor??4294967295,y=l.color,C=(v>>>24&255)/255*((y>>>24&255)/255)*(r.filter?.alphaMultiplier??1);if(C<=0)continue;s.globalAlpha=C;const _=16777215&v,w=16777215&y,T=(0,m.D)((0,x.u)(w,_)),b=h.frame,k=u.addressModeU??u.addressMode,M=u.addressModeV??u.addressMode,I=e._getPatternRepeat(k,M),P=h.source._resolution??h.source.resolution??1,S=l.renderable?.renderGroup?.isCachedAsTexture,A=b.x*P,R=b.y*P,W=b.width*P,H=b.height*P,E=l.bounds,B=r.renderTarget.renderTarget.isRoot,O=E.minX,D=E.minY,U=E.maxX-E.minX,q=E.maxY-E.minY,F=h.rotate,V=h.uvs,G=Math.min(V.x0,V.x1,V.x2,V.x3,V.y0,V.y1,V.y2,V.y3),L=Math.max(V.x0,V.x1,V.x2,V.x3,V.y0,V.y1,V.y2,V.y3),X="no-repeat"!==I&&(G<0||L>1),Y=F&&!(!X&&(16777215!==T||F));Y?(e._tempPatternMatrix.copyFrom(l.transform),i.E.matrixAppendRotationInv(e._tempPatternMatrix,F,O,D,U,q),o.setContextTransform(e._tempPatternMatrix,1===l.roundPixels,void 0,S&&B)):o.setContextTransform(l.transform,1===l.roundPixels,void 0,S&&B);const j=Y?0:O,Q=Y?0:D,N=U,z=q;if(X){let t=d;const n=16777215!==T&&!F,a=b.width<=h.source.width&&b.height<=h.source.height;n&&a&&(t=p.getTintedCanvas({texture:h},T));const r=s.createPattern(t,I);if(!r)continue;const o=N,i=z;if(0===o||0===i)continue;const c=1/o,l=1/i,u=(V.x1-V.x0)*c,g=(V.y1-V.y0)*c,m=(V.x3-V.x0)*l,x=(V.y3-V.y0)*l,f=V.x0-u*j-m*Q,v=V.y0-g*j-x*Q,y=h.source.pixelWidth,C=h.source.pixelHeight;e._tempPatternMatrix.set(u*y,g*C,m*y,x*C,f*y,v*C),p.applyPatternTransform(r,e._tempPatternMatrix),s.fillStyle=r,s.fillRect(j,Q,N,z)}else{const e=16777215!==T||F?p.getTintedCanvas({texture:h},T):d,t=e!==d;s.drawImage(e,t?0:A,t?0:R,t?e.width:W,t?e.height:H,j,Q,N,z)}}}};W._tempPatternMatrix=new s.u,W.extension={type:[a.Ag.CanvasPipesAdaptor],name:"batch"};let H=W;var E=n(780),B=n(9824);class O{constructor(e){this._colorStack=[],this._colorStackIndex=0,this._currentColor=0,this._renderer=e}buildStart(){this._colorStack[0]=15,this._colorStackIndex=1,this._currentColor=15}push(e,t,n){this._renderer.renderPipes.batch.break(n);const a=this._colorStack;a[this._colorStackIndex]=a[this._colorStackIndex-1]&e.mask;const r=this._colorStack[this._colorStackIndex];r!==this._currentColor&&(this._currentColor=r,n.add({renderPipeId:"colorMask",colorMask:r,canBundle:!1})),this._colorStackIndex++}pop(e,t,n){this._renderer.renderPipes.batch.break(n);const a=this._colorStack;this._colorStackIndex--;const r=a[this._colorStackIndex-1];r!==this._currentColor&&(this._currentColor=r,n.add({renderPipeId:"colorMask",colorMask:r,canBundle:!1}))}execute(e){}destroy(){this._renderer=null,this._colorStack=null}}O.extension={type:[a.Ag.CanvasPipes],name:"colorMask"};var D=n(6442),U=n(268);function q(e,t){switch(t.type){case"rectangle":{const n=t;e.rect(n.x,n.y,n.width,n.height);break}case"roundedRectangle":{const n=t;!function(e,t,n,a,r,o){o=Math.max(0,Math.min(o,Math.min(a,r)/2)),e.moveTo(t+o,n),e.lineTo(t+a-o,n),e.quadraticCurveTo(t+a,n,t+a,n+o),e.lineTo(t+a,n+r-o),e.quadraticCurveTo(t+a,n+r,t+a-o,n+r),e.lineTo(t+o,n+r),e.quadraticCurveTo(t,n+r,t,n+r-o),e.lineTo(t,n+o),e.quadraticCurveTo(t,n,t+o,n)}(e,n.x,n.y,n.width,n.height,n.radius);break}case"circle":{const n=t;e.moveTo(n.x+n.radius,n.y),e.arc(n.x,n.y,n.radius,0,2*Math.PI);break}case"ellipse":{const n=t;e.ellipse?(e.moveTo(n.x+n.halfWidth,n.y),e.ellipse(n.x,n.y,n.halfWidth,n.halfHeight,0,0,2*Math.PI)):(e.save(),e.translate(n.x,n.y),e.scale(n.halfWidth,n.halfHeight),e.moveTo(1,0),e.arc(0,0,1,0,2*Math.PI),e.restore());break}case"triangle":{const n=t;e.moveTo(n.x,n.y),e.lineTo(n.x2,n.y2),e.lineTo(n.x3,n.y3),e.closePath();break}default:{const n=t,a=n.points;if(!a?.length)break;e.moveTo(a[0],a[1]);for(let t=2;t<a.length;t+=2)e.lineTo(a[t],a[t+1]);n.closePath&&e.closePath();break}}}function F(e,t){if(!t?.length)return!1;for(let n=0;n<t.length;n++){const a=t[n];if(!a?.shape)continue;const r=a.transform,o=r&&!r.isIdentity();o&&(e.save(),e.transform(r.a,r.b,r.c,r.d,r.tx,r.ty)),q(e,a.shape),o&&e.restore()}return!0}class V{constructor(e){this._warnedMaskTypes=new Set,this._canvasMaskStack=[],this._renderer=e}push(e,t,n){this._renderer.renderPipes.batch.break(n),n.add({renderPipeId:"stencilMask",action:"pushMaskBegin",mask:e,inverse:t._maskOptions.inverse,canBundle:!1})}pop(e,t,n){this._renderer.renderPipes.batch.break(n),n.add({renderPipeId:"stencilMask",action:"popMaskEnd",mask:e,inverse:t._maskOptions.inverse,canBundle:!1})}execute(e){if("pushMaskBegin"!==e.action&&"popMaskEnd"!==e.action)return;const t=this._renderer,n=t.canvasContext,a=n?.activeContext;if(!a)return;if("popMaskEnd"===e.action)return void(this._canvasMaskStack.pop()&&a.restore());e.inverse&&this._warnOnce("inverse","CanvasRenderer: inverse masks are not supported on Canvas2D; ignoring inverse flag.");const r=e.mask.mask;if(!(r instanceof D.A))return this._warnOnce("nonGraphics","CanvasRenderer: only Graphics masks are supported in Canvas2D; skipping mask."),void this._canvasMaskStack.push(!1);const o=r,i=o.context?.instructions;if(!i?.length)return void this._canvasMaskStack.push(!1);a.save(),n.setContextTransform(o.groupTransform,1===(t._roundPixels|o._roundPixels)),a.beginPath();let s=!1,c=!1;for(let e=0;e<i.length;e++){const t=i[e],n=t.action;if("fill"!==n&&"stroke"!==n)continue;const r=t.data,o=r?.path?.shapePath;if(!o?.shapePrimitives?.length)continue;const l=o.shapePrimitives;for(let e=0;e<l.length;e++){const t=l[e];if(!t?.shape)continue;const n=t.transform,r=n&&!n.isIdentity();r&&(a.save(),a.transform(n.a,n.b,n.c,n.d,n.tx,n.ty)),q(a,t.shape),c=F(a,t.holes)||c,s=!0,r&&a.restore()}}if(!s)return a.restore(),void this._canvasMaskStack.push(!1);c?a.clip("evenodd"):a.clip(),this._canvasMaskStack.push(!0)}destroy(){this._renderer=null,this._warnedMaskTypes=null,this._canvasMaskStack=null}_warnOnce(e,t){this._warnedMaskTypes.has(e)||(this._warnedMaskTypes.add(e),(0,U.R)(t))}}V.extension={type:[a.Ag.CanvasPipes],name:"stencilMask"};var G=n(360),L=n(800),X=n(5362),Y=n(5099);const j="source-over",Q=new s.u;class N{constructor(e){this.activeResolution=1,this.smoothProperty="imageSmoothingEnabled",this.blendModes=function(){const e=u(),t=Object.create(null);return t.inherit=j,t.none=j,t.normal="source-over",t.add="lighter",t.multiply=e?"multiply":j,t.screen=e?"screen":j,t.overlay=e?"overlay":j,t.darken=e?"darken":j,t.lighten=e?"lighten":j,t["color-dodge"]=e?"color-dodge":j,t["color-burn"]=e?"color-burn":j,t["hard-light"]=e?"hard-light":j,t["soft-light"]=e?"soft-light":j,t.difference=e?"difference":j,t.exclusion=e?"exclusion":j,t.saturation=e?"saturation":j,t.color=e?"color":j,t.luminosity=e?"luminosity":j,t["linear-burn"]=e?"color-burn":j,t["linear-dodge"]=e?"color-dodge":j,t["linear-light"]=e?"hard-light":j,t["pin-light"]=e?"hard-light":j,t["vivid-light"]=e?"hard-light":j,t["hard-mix"]=j,t.negation=e?"difference":j,t["normal-npm"]=t.normal,t["add-npm"]=t.add,t["screen-npm"]=t.screen,t.erase="destination-out",t.subtract=j,t.divide=j,t.min=j,t.max=j,t}(),this._activeBlendMode="normal",this._projTransform=null,this._outerBlend=!1,this._warnedBlendModes=new Set,this._renderer=e}resolutionChange(e){this.activeResolution=e}init(){const e=this._renderer.background.alpha<1;if(this.rootContext=this._renderer.canvas.getContext("2d",{alpha:e}),this.activeContext=this.rootContext,this.activeResolution=this._renderer.resolution,!this.rootContext.imageSmoothingEnabled){const e=this.rootContext;e.webkitImageSmoothingEnabled?this.smoothProperty="webkitImageSmoothingEnabled":e.mozImageSmoothingEnabled?this.smoothProperty="mozImageSmoothingEnabled":e.oImageSmoothingEnabled?this.smoothProperty="oImageSmoothingEnabled":e.msImageSmoothingEnabled&&(this.smoothProperty="msImageSmoothingEnabled")}}setContextTransform(e,t,n,a){const r=a?s.u.IDENTITY:this._renderer.globalUniforms.globalUniformData?.worldTransformMatrix||s.u.IDENTITY;let o=Q;o.copyFrom(r),o.append(e);const i=this._projTransform,c=this.activeResolution;if(n=n||c,i){const e=s.u.shared;e.copyFrom(o),e.prepend(i),o=e}t?this.activeContext.setTransform(o.a*n,o.b*n,o.c*n,o.d*n,o.tx*c|0,o.ty*c|0):this.activeContext.setTransform(o.a*n,o.b*n,o.c*n,o.d*n,o.tx*c,o.ty*c)}clear(e,t){const n=this.activeContext,a=this._renderer;if(n.clearRect(0,0,a.width,a.height),e){const r=c.Q.shared.setValue(e);n.globalAlpha=t??r.alpha,n.fillStyle=r.toHex(),n.fillRect(0,0,a.width,a.height),n.globalAlpha=1}}setBlendMode(e){if(this._activeBlendMode===e)return;this._activeBlendMode=e,this._outerBlend=!1;const t=this.blendModes[e];if(!t)return this._warnedBlendModes.has(e)||(console.warn(`CanvasRenderer: blend mode "${e}" is not supported in Canvas2D; falling back to "source-over".`),this._warnedBlendModes.add(e)),void(this.activeContext.globalCompositeOperation="source-over");this.activeContext.globalCompositeOperation=t}destroy(){this.rootContext=null,this.activeContext=null,this._warnedBlendModes.clear()}}N.extension={type:[a.Ag.CanvasSystem],name:"canvasContext"};class z{constructor(){this.maxTextures=16,this.maxBatchableTextures=16,this.maxUniformBindings=0}init(){}}z.extension={type:[a.Ag.CanvasSystem],name:"limits"};var $=n(7238),J=n(4884);class K{init(e,t){this._renderer=e,this._renderTargetSystem=t}initGpuRenderTarget(e){const t=e.colorTexture,{canvas:n,context:a}=this._ensureCanvas(t);return{canvas:n,context:a,width:n.width,height:n.height}}resizeGpuRenderTarget(e){const t=e.colorTexture,{canvas:n}=this._ensureCanvas(t);n.width=e.pixelWidth,n.height=e.pixelHeight}startRenderPass(e,t,n,a){const r=this._renderTargetSystem.getGpuRenderTarget(e);this._renderer.canvasContext.activeContext=r.context,this._renderer.canvasContext.activeResolution=e.resolution,t&&this.clear(e,t,n,a)}clear(e,t,n,a){const r=this._renderTargetSystem.getGpuRenderTarget(e).context,o=a||{x:0,y:0,width:e.pixelWidth,height:e.pixelHeight};if(r.setTransform(1,0,0,1,0,0),r.clearRect(o.x,o.y,o.width,o.height),n){const e=c.Q.shared.setValue(n);e.alpha>0&&(r.globalAlpha=e.alpha,r.fillStyle=e.toHex(),r.fillRect(o.x,o.y,o.width,o.height),r.globalAlpha=1)}}finishRenderPass(){}copyToTexture(e,t,n,a,r){const o=this._renderTargetSystem.getGpuRenderTarget(e).canvas,i=t.source,{context:s}=this._ensureCanvas(i),c=r?.x??0,l=r?.y??0;return s.drawImage(o,n.x,n.y,a.width,a.height,c,l,a.width,a.height),i.update(),t}destroyGpuRenderTarget(e){}_ensureCanvas(e){let t=e.resource;t&&J.q.test(t)||(t=l.e.get().createCanvas(e.pixelWidth,e.pixelHeight),e.resource=t),t.width===e.pixelWidth&&t.height===e.pixelHeight||(t.width=e.pixelWidth,t.height=e.pixelHeight);const n=t.getContext("2d");return{canvas:t,context:n}}}class Z extends $.l{constructor(e){super(e),this.adaptor=new K,this.adaptor.init(e,this)}}Z.extension={type:[a.Ag.CanvasSystem],name:"renderTarget"};class ee{constructor(e){}init(){}initSource(e){}generateCanvas(e){const t=l.e.get().createCanvas(),n=t.getContext("2d"),a=p.getCanvasSource(e);if(!a)return t;const r=e.frame,o=e.source._resolution??e.source.resolution??1,i=r.x*o,s=r.y*o,c=r.width*o,h=r.height*o;return t.width=Math.ceil(c),t.height=Math.ceil(h),n.drawImage(a,i,s,c,h,0,0,c,h),t}getPixels(e){const t=this.generateCanvas(e);return{pixels:t.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,t.width,t.height).data,width:t.width,height:t.height}}destroy(){}}ee.extension={type:[a.Ag.CanvasSystem],name:"texture"};const te=[...X.i,N,z,ee,Z],ne=[G.j,E.s,R.k,o.a,B.z,V,O,r._],ae=[H,A],re=[],oe=[],ie=[];a.XO.handleByNamedList(a.Ag.CanvasSystem,re),a.XO.handleByNamedList(a.Ag.CanvasPipes,oe),a.XO.handleByNamedList(a.Ag.CanvasPipesAdaptor,ie),a.XO.add(...te,...ne,...ae);class se extends L.k{constructor(){super({name:"canvas",type:Y.W.CANVAS,systems:re,renderPipes:oe,renderPipeAdaptors:ie})}}}}]);